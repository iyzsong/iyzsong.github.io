const ve={gb:"mgba",gba:"mgba",gbc:"mgba",megadrive:"genesis_plus_gx",nes:"fceumm",snes:"snes9x"};function ce(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var O,J;function we(){if(J)return O;J=1;const{hasOwnProperty:r}=Object.prototype,e=(i,c={})=>{typeof c=="string"&&(c={section:c}),c.align=c.align===!0,c.newline=c.newline===!0,c.sort=c.sort===!0,c.whitespace=c.whitespace===!0||c.align===!0,c.platform=c.platform||typeof process<"u"&&process.platform,c.bracketedArray=c.bracketedArray!==!1;const l=c.platform==="win32"?`\r
`:`
`,u=c.whitespace?" = ":"=",m=[],h=c.sort?Object.keys(i).sort():Object.keys(i);let b=0;c.align&&(b=s(h.filter(f=>i[f]===null||Array.isArray(i[f])||typeof i[f]!="object").map(f=>Array.isArray(i[f])?`${f}[]`:f).concat([""]).reduce((f,g)=>s(f).length>=s(g).length?f:g)).length);let d="";const p=c.bracketedArray?"[]":"";for(const f of h){const g=i[f];if(g&&Array.isArray(g))for(const y of g)d+=s(`${f}${p}`).padEnd(b," ")+u+s(y)+l;else g&&typeof g=="object"?m.push(f):d+=s(f).padEnd(b," ")+u+s(g)+l}c.section&&d.length&&(d="["+s(c.section)+"]"+(c.newline?l+l:l)+d);for(const f of m){const g=t(f,".").join("\\."),y=(c.section?c.section+".":"")+g,A=e(i[f],{...c,section:y});d.length&&A.length&&(d+=l),d+=A}return d};function t(i,c){var l=0,u=0,m=0,h=[];do if(m=i.indexOf(c,l),m!==-1){if(l=m+c.length,m>0&&i[m-1]==="\\")continue;h.push(i.slice(u,m)),u=m+c.length}while(m!==-1);return h.push(i.slice(u)),h}const a=(i,c={})=>{c.bracketedArray=c.bracketedArray!==!1;const l=Object.create(null);let u=l,m=null;const h=/^\[([^\]]*)\]\s*$|^([^=]+)(=(.*))?$/i,b=i.split(/[\r\n]+/g),d={};for(const f of b){if(!f||f.match(/^\s*[;#]/)||f.match(/^\s*$/))continue;const g=f.match(h);if(!g)continue;if(g[1]!==void 0){if(m=o(g[1]),m==="__proto__"){u=Object.create(null);continue}u=l[m]=l[m]||Object.create(null);continue}const y=o(g[2]);let A;c.bracketedArray?A=y.length>2&&y.slice(-2)==="[]":(d[y]=(d?.[y]||0)+1,A=d[y]>1);const w=A&&y.endsWith("[]")?y.slice(0,-2):y;if(w==="__proto__")continue;const R=g[3]?o(g[4]):!0,q=R==="true"||R==="false"||R==="null"?JSON.parse(R):R;A&&(r.call(u,w)?Array.isArray(u[w])||(u[w]=[u[w]]):u[w]=[]),Array.isArray(u[w])?u[w].push(q):u[w]=q}const p=[];for(const f of Object.keys(l)){if(!r.call(l,f)||typeof l[f]!="object"||Array.isArray(l[f]))continue;const g=t(f,".");u=l;const y=g.pop(),A=y.replace(/\\\./g,".");for(const w of g)w!=="__proto__"&&((!r.call(u,w)||typeof u[w]!="object")&&(u[w]=Object.create(null)),u=u[w]);u===l&&A===y||(u[A]=l[f],p.push(f))}for(const f of p)delete l[f];return l},n=i=>i.startsWith('"')&&i.endsWith('"')||i.startsWith("'")&&i.endsWith("'"),s=i=>typeof i!="string"||i.match(/[=\r\n]/)||i.match(/^\[/)||i.length>1&&n(i)||i!==i.trim()?JSON.stringify(i):i.split(";").join("\\;").split("#").join("\\#"),o=i=>{if(i=(i||"").trim(),n(i)){i.charAt(0)==="'"&&(i=i.slice(1,-1));try{i=JSON.parse(i)}catch{}}else{let c=!1,l="";for(let u=0,m=i.length;u<m;u++){const h=i.charAt(u);if(c)"\\;#".indexOf(h)!==-1?l+=h:l+="\\"+h,c=!1;else{if(";#".indexOf(h)!==-1)break;h==="\\"?c=!0:l+=h}}return c&&(l+="\\"),l.trim()}return i};return O={parse:a,decode:a,stringify:e,encode:e,safe:s,unsafe:o},O}var _e=we();const Ee=ce(_e);var j,X;function Se(){if(X)return j;X=1;function r(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}function e(n,s){for(var o="",i=0,c=-1,l=0,u,m=0;m<=n.length;++m){if(m<n.length)u=n.charCodeAt(m);else{if(u===47)break;u=47}if(u===47){if(!(c===m-1||l===1))if(c!==m-1&&l===2){if(o.length<2||i!==2||o.charCodeAt(o.length-1)!==46||o.charCodeAt(o.length-2)!==46){if(o.length>2){var h=o.lastIndexOf("/");if(h!==o.length-1){h===-1?(o="",i=0):(o=o.slice(0,h),i=o.length-1-o.lastIndexOf("/")),c=m,l=0;continue}}else if(o.length===2||o.length===1){o="",i=0,c=m,l=0;continue}}s&&(o.length>0?o+="/..":o="..",i=2)}else o.length>0?o+="/"+n.slice(c+1,m):o=n.slice(c+1,m),i=m-c-1;c=m,l=0}else u===46&&l!==-1?++l:l=-1}return o}function t(n,s){var o=s.dir||s.root,i=s.base||(s.name||"")+(s.ext||"");return o?o===s.root?o+i:o+n+i:i}var a={resolve:function(){for(var s="",o=!1,i,c=arguments.length-1;c>=-1&&!o;c--){var l;c>=0?l=arguments[c]:(i===void 0&&(i=process.cwd()),l=i),r(l),l.length!==0&&(s=l+"/"+s,o=l.charCodeAt(0)===47)}return s=e(s,!o),o?s.length>0?"/"+s:"/":s.length>0?s:"."},normalize:function(s){if(r(s),s.length===0)return".";var o=s.charCodeAt(0)===47,i=s.charCodeAt(s.length-1)===47;return s=e(s,!o),s.length===0&&!o&&(s="."),s.length>0&&i&&(s+="/"),o?"/"+s:s},isAbsolute:function(s){return r(s),s.length>0&&s.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var s,o=0;o<arguments.length;++o){var i=arguments[o];r(i),i.length>0&&(s===void 0?s=i:s+="/"+i)}return s===void 0?".":a.normalize(s)},relative:function(s,o){if(r(s),r(o),s===o||(s=a.resolve(s),o=a.resolve(o),s===o))return"";for(var i=1;i<s.length&&s.charCodeAt(i)===47;++i);for(var c=s.length,l=c-i,u=1;u<o.length&&o.charCodeAt(u)===47;++u);for(var m=o.length,h=m-u,b=l<h?l:h,d=-1,p=0;p<=b;++p){if(p===b){if(h>b){if(o.charCodeAt(u+p)===47)return o.slice(u+p+1);if(p===0)return o.slice(u+p)}else l>b&&(s.charCodeAt(i+p)===47?d=p:p===0&&(d=0));break}var f=s.charCodeAt(i+p),g=o.charCodeAt(u+p);if(f!==g)break;f===47&&(d=p)}var y="";for(p=i+d+1;p<=c;++p)(p===c||s.charCodeAt(p)===47)&&(y.length===0?y+="..":y+="/..");return y.length>0?y+o.slice(u+d):(u+=d,o.charCodeAt(u)===47&&++u,o.slice(u))},_makeLong:function(s){return s},dirname:function(s){if(r(s),s.length===0)return".";for(var o=s.charCodeAt(0),i=o===47,c=-1,l=!0,u=s.length-1;u>=1;--u)if(o=s.charCodeAt(u),o===47){if(!l){c=u;break}}else l=!1;return c===-1?i?"/":".":i&&c===1?"//":s.slice(0,c)},basename:function(s,o){if(o!==void 0&&typeof o!="string")throw new TypeError('"ext" argument must be a string');r(s);var i=0,c=-1,l=!0,u;if(o!==void 0&&o.length>0&&o.length<=s.length){if(o.length===s.length&&o===s)return"";var m=o.length-1,h=-1;for(u=s.length-1;u>=0;--u){var b=s.charCodeAt(u);if(b===47){if(!l){i=u+1;break}}else h===-1&&(l=!1,h=u+1),m>=0&&(b===o.charCodeAt(m)?--m===-1&&(c=u):(m=-1,c=h))}return i===c?c=h:c===-1&&(c=s.length),s.slice(i,c)}else{for(u=s.length-1;u>=0;--u)if(s.charCodeAt(u)===47){if(!l){i=u+1;break}}else c===-1&&(l=!1,c=u+1);return c===-1?"":s.slice(i,c)}},extname:function(s){r(s);for(var o=-1,i=0,c=-1,l=!0,u=0,m=s.length-1;m>=0;--m){var h=s.charCodeAt(m);if(h===47){if(!l){i=m+1;break}continue}c===-1&&(l=!1,c=m+1),h===46?o===-1?o=m:u!==1&&(u=1):o!==-1&&(u=-1)}return o===-1||c===-1||u===0||u===1&&o===c-1&&o===i+1?"":s.slice(o,c)},format:function(s){if(s===null||typeof s!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof s);return t("/",s)},parse:function(s){r(s);var o={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return o;var i=s.charCodeAt(0),c=i===47,l;c?(o.root="/",l=1):l=0;for(var u=-1,m=0,h=-1,b=!0,d=s.length-1,p=0;d>=l;--d){if(i=s.charCodeAt(d),i===47){if(!b){m=d+1;break}continue}h===-1&&(b=!1,h=d+1),i===46?u===-1?u=d:p!==1&&(p=1):u!==-1&&(p=-1)}return u===-1||h===-1||p===0||p===1&&u===h-1&&u===m+1?h!==-1&&(m===0&&c?o.base=o.name=s.slice(1,h):o.base=o.name=s.slice(m,h)):(m===0&&c?(o.name=s.slice(1,u),o.base=s.slice(1,h)):(o.name=s.slice(m,u),o.base=s.slice(m,h)),o.ext=s.slice(u,h)),m>0?o.dir=s.slice(0,m-1):c&&(o.dir="/"),o},sep:"/",delimiter:":",win32:null,posix:null};return a.posix=a,j=a,j}var Ce=Se();const Ae=ce(Ce),N={ini:Ee,path:Ae},{path:K}=N,xe=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/,Fe=/[?/#]/;function Me(r){if(typeof r!="string")return!1;if(["http://","https://","data:","blob:","./","../"].some(a=>r.startsWith(a)))return!0;if(["#","{"].some(a=>r.startsWith(a))||r.includes(`
`))return!1;const t=r.split(Fe);return t.length<2?!1:t.every(a=>a.length<100)}function ue(r){return typeof globalThis.URL=="function"&&r instanceof globalThis.URL}function le(r){return typeof globalThis.Request=="function"&&r instanceof globalThis.Request}function Te(r){return typeof globalThis.Response=="function"&&r instanceof globalThis.Response}function Pe(r){return typeof globalThis.ArrayBuffer=="function"&&r instanceof globalThis.ArrayBuffer}function ke(r){return typeof globalThis.Uint8Array=="function"&&r instanceof globalThis.Uint8Array}function Ne(r){return typeof globalThis.Blob=="function"&&r instanceof globalThis.Blob}function Re(r){return typeof globalThis.FileSystemFileHandle=="function"&&r instanceof globalThis.FileSystemFileHandle}function Ge(r){return Me(r)||ue(r)||le(r)}class _{name="";get baseName(){return K.parse(this.name).name}get extension(){return K.parse(this.name).ext}arrayBuffer;blob;blobType="application/octet-stream";objectUrl;raw;signal;text;uint8Array;urlResolver;constructor({blobType:e,name:t,raw:a,signal:n,urlResolver:s}){this.raw=a,n&&(this.signal=n),s&&(this.urlResolver=s),e&&(this.blobType=e),t&&(this.name=M(t))}static async create(e){if(H(e))throw new Error("parameter is not valid");if(e instanceof _)return e;const t=typeof e=="object"&&"raw"in e?e:{raw:e},a=new _(t);return await a.load(),a}dispose(){typeof this.objectUrl=="string"&&URL.revokeObjectURL(this.objectUrl)}async getArrayBuffer(){return this.arrayBuffer?this.arrayBuffer:(this.arrayBuffer=await this.getBlob().arrayBuffer(),this.arrayBuffer)}getBlob(){if(!this.blob)throw new Error("blob is not available");return this.blob}getObjectUrl(){return this.objectUrl?this.objectUrl:(this.objectUrl=URL.createObjectURL(this.getBlob()),this.objectUrl)}async getText(){return this.text!==void 0?this.text:(this.text=await this.getBlob().text(),this.text)}async getUint8Array(){if(this.uint8Array)return this.uint8Array;const e=await this.getArrayBuffer();return this.uint8Array=new Uint8Array(e),this.uint8Array}async load(){const e=await C(this.urlResolver?this.urlResolver(this):this.raw);if(typeof e=="object"&&"fileContent"in e&&"fileName"in e){const[t,a]=await Promise.all([C(e.fileName),C(e.fileContent)]);await this.loadContent({fileContent:a,fileName:t})}else await this.loadContent(e)}loadArrayBuffer(e){this.arrayBuffer=e,this.blob=new Blob([e],{type:this.blobType})}async loadContent(e){if(Ne(e))this.blob=e;else if(Ge(e))await this.loadFetchable(e);else if(typeof e=="string")this.loadPlainText(e);else if(de(e?.fileContent))await this.loadObject(e);else if(Pe(e))this.loadArrayBuffer(e);else if(ke(e))this.loadUint8Array(e);else if(Te(e))await this.loadResponse(e);else if(Re(e))await this.loadFileSystemFileHandle(e);else throw new TypeError("failed to resolve the file, file content:",e);const t=await this.getUint8Array(),a=We(t)?"zip":"bin";this.name||=pe(a)}async loadFetchable(e){le(e)?this.name||=M(e.url):ue(e)?this.name||=M(e.href):this.name||=M(e);const t=await fetch(e,{signal:this.signal||null});await this.loadResponse(t)}async loadFileSystemFileHandle(e){const t=await e.getFile();this.blob=t,this.name=M(t.name)}async loadObject(e){let{fileContent:t,fileName:a}=e;[a,t]=await Promise.all([C(a),C(t)]),this.name||=M(a),await this.loadContent(t)}loadPlainText(e){this.blob=new Blob([e],{type:this.blobType})}async loadResponse(e){const t=e.headers.get("Content-Disposition");if(t){const a=xe.exec(t)?.[1]?.replaceAll(/['"]/g,"");a&&(this.name||=M(a))}if(!e.ok)throw new Error("Failed to load response",{cause:e});this.blob=await e.blob(),this.name||=M(e.url)}loadUint8Array(e){this.uint8Array=e,this.blob=new Blob([e],{type:this.blobType})}}const Q=globalThis.setImmediate;let G=null;const Z=[];function me(r,...e){return typeof Q=="function"?Q(r,...e):typeof MessageChannel<"u"?(G||(G=new MessageChannel,G.port1.addEventListener("message",()=>{const t=Z.shift();if(t)try{t()}catch{}}),G.port1.start()),Z.push(()=>r(...e)),G.port2.postMessage(0),0):setTimeout(()=>r(...e),0)}function Be(){typeof globalThis.setImmediate!="function"&&(globalThis.setImmediate=me)}function he(){globalThis.setImmediate===me&&delete globalThis.setImmediate}const{path:fe}=N,De=new TextEncoder;function Le(r){let e=r;try{e=new URL(r).pathname}catch{}const t=fe.basename(e);try{return decodeURIComponent(t)}catch{return t}}let Y=0;function Oe(){return Y+=1,Y}function pe(r="bin"){return`data${Oe()}.${r}`}function M(r){let e=Le(r)||"";return e=e.replaceAll(/["%*/:<>?\\|]/g,"-"),fe.parse(e).ext?e:""}function je(r){return!r||typeof r!="string"?!1:["http://","https://","//","data:","blob:"].some(t=>r.startsWith(t))}function $e(r,e){if(r)for(const t in e){const a=e[t];r.style[t]=a||null}}function U(r){return new Promise(e=>{setTimeout(e,r)})}function Ie(r){return r.startsWith("var Module")}function Ue(r){return r.includes("import.meta.url")}async function Ve({js:r,name:e}){let t=await r.getText();return Ie(t)?t=`export function getEmscripten({ Module }) {
        ${t};
        Module.FS = FS;
        Module.PATH = PATH;
        Module.ERRNO_CODES = ERRNO_CODES;
        return {
          AL: typeof AL === 'undefined' ? null: AL,
          Browser: typeof Browser === 'undefined' ? null: Browser,
          JSEvents,
          Module,
          exit: _emscripten_force_exit
         }
      }`:Ue(t)&&(t=`${t.replace("var setImmediate","").replace("readyPromiseResolve(Module)",`readyPromiseResolve({
        AL: typeof AL === 'undefined' ? null: AL,
        Browser: typeof Browser === 'undefined' ? null: Browser,
        JSEvents,
        Module,
        exit: _emscripten_force_exit
      })`)};
    export function getEmscripten({ Module }) {
      const fnA = (typeof libretro_${e} === "function") ? libretro_${e} : null;
      const fnB = (typeof ${e} === "function") ? ${e} : null;

      const factory = fnA || fnB;

      return factory ? factory(Module) : null;
    }
    `),t}async function ze({js:r,name:e}){const t=await Ve({js:r,name:e}),a=await _.create({blobType:"application/javascript",raw:t}),n=a.getObjectUrl();try{return await import(n)}catch{return await new Function(`return import('${n}')`)()}finally{a.dispose()}}function H(r){return r==null}function $(r){return H(r)?!1:r.constructor===Object||!r.constructor}function He(r,e,t){const a=r[t],n=e[t];H(a)?r[t]=n:Array.isArray(a)&&Array.isArray(n)?r[t]=[...a,...n]:$(a)&&$(n)?(r[t]=$(a)?r[t]:{},T(r[t],n)):r[t]=n}function T(r,...e){if(e.length===1){const[t]=e;for(const a in t)He(r,t,a)}else for(const t of e)T(r,t)}function F(r){if(r?.aborted)throw he(),new Error("Launch aborted")}function B(r){return(r<10?"0":"")+r}async function C(r){return r&&(typeof r?.then=="function"?C(await r):typeof r=="function"?C(r()):r)}function de(r){return typeof r=="string"?!0:[globalThis.Response,globalThis.Uint8Array,globalThis.URL,globalThis.Request,globalThis.Response,globalThis.FileSystemFileHandle,globalThis.Blob].some(t=>t&&r instanceof t)}function ge(r){return typeof r=="string"||"fileContent"in r?!0:Array.isArray(r)?r.every(e=>ge(e)):de(r)}function We(r){return r[0]===80&&r[1]===75&&(r[2]===3||r[2]===5||r[2]===7)&&(r[3]===4||r[3]===6||r[3]===8)}const{path:I}=N;function qe(){return{menu_driver:"rgui",menu_navigation_browser_filter_supported_extensions_enable:!1,notification_show_when_menu_is_alive:!0,savestate_auto_load:!0,savestate_thumbnail_enable:!0,stdin_cmd_enable:!0,video_shader_enable:!0,input_audio_mute:"nul",input_cheat_index_minus:"nul",input_cheat_index_plus:"nul",input_cheat_toggle:"nul",input_desktop_menu_toggle:"nul",input_exit_emulator:"nul",input_fps_toggle:"nul",input_frame_advance:"nul",input_game_focus_toggle:"nul",input_grab_mouse_toggle:"nul",input_hold_fast_forward:"nul",input_hold_slowmotion:"nul",input_load_state:"nul",input_netplay_game_watch:"nul",input_netplay_player_chat:"nul",input_pause_toggle:"nul",input_reset:"nul",input_rewind:"nul",input_save_state:"nul",input_screenshot:"nul",input_shader_next:"nul",input_shader_prev:"nul",input_shader_toggle:"nul",input_state_slot_decrease:"nul",input_state_slot_increase:"nul",input_toggle_fast_forward:"nul",input_toggle_fullscreen:"nul",input_volume_down:"nul",input_volume_up:"nul",input_player1_analog_dpad_mode:1,input_player2_analog_dpad_mode:1,input_player3_analog_dpad_mode:1,input_player4_analog_dpad_mode:1}}const L="https://cdn.jsdelivr.net/gh",Je="arianrhodsandlot/retroarch-emscripten-build",Xe="v1.22.2",Ke="retroarch",ee="libretro/glsl-shaders",te="468f67b6f6788e2719d1dd28dfb2c9b7c3db3cc7",Qe="https://cdn.jsdelivr.net/npm/@zip.js/zip.js@2.8.11/+esm",D=new Map;async function Ze(r){const e=`${L}/${Je}@${Xe}/${Ke}/${r}_libretro.zip`,[{BlobReader:t,BlobWriter:a,ZipReader:n},s]=await Promise.all([import(Qe),fetch(e)]),o=await s.blob(),i=new t(o),l=await new n(i).getEntries(),u={};if(await Promise.all(l.map(async m=>{m&&!m.directory&&(m.filename.endsWith(".js")?u.js=await m.getData?.(new a("application/octet-stream")):m.filename.endsWith(".wasm")&&(u.wasm=await m.getData?.(new a("application/octet-stream"))))})),!u.js||!u.wasm)throw new Error(`Failed to extract core files for ${r}`);return u}async function se(r){if(D.has(r))return D.get(r);const e=Ze(r);D.set(r,e);const t=await e;return D.delete(r),t}function ye(){return{element:"",retroarchConfig:qe(),retroarchCoreConfig:{},runEmulatorManually:!1,setupEmulatorManually:!1,async resolveCoreJs(e){if(typeof e!="string")throw new TypeError("the core name must be a string");const{js:t}=await se(e);if(!t)throw new Error(`Failed to load core JS for ${e}`);return t},async resolveCoreWasm(e){if(typeof e!="string")throw new TypeError("the core name must be a string");const{wasm:t}=await se(e);if(!t)throw new Error(`failed to load core WASM for ${e}`);return t},resolveRom(e){if(typeof e!="string")return e||[];if(je(e))return e;const t=I.extname(e),a={".bin":"retrobrews/md-games",".gb":"retrobrews/gbc-games",".gba":"retrobrews/gba-games",".gbc":"retrobrews/gbc-games",".md":"retrobrews/md-games",".nes":"retrobrews/nes-games",".sfc":"retrobrews/snes-games",".sms":"retrobrews/sms-games"}[t];if(a){const n=encodeURIComponent(e);return`${L}/${a}@master/${n}`}return e},resolveBios(e){return e},resolveShader(e){if(!e)return[];const t=`${L}/${ee}@${te}/${e}.glslp`,a=e.split(I.sep);a.splice(-1,0,"shaders");const n=`${L}/${ee}@${te}/${a.join(I.sep)}.glsl`;return[t,n]}}}let W=ye();function V(){return W}function Ye(r){T(W,r)}function et(){W=ye()}function tt(r){if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)}function re(r){return typeof r=="string"||tt(r)}function ae(){return{bios:new Map,core:new Map,rom:new Map,shader:new Map,sram:new Map,state:new Map}}class P{static cacheStorage=ae();beforeLaunch;bios=[];cache={bios:!1,core:!1,rom:!1,shader:!1,sram:!1,state:!1};core={};element;emscriptenModule;respondToGlobalEvents;rom=[];shader=[];signal;size;sram;sramType;state;waitForInteraction;get retroarchConfig(){const e={};return T(e,V().retroarchConfig,this.nostalgistOptions.retroarchConfig),e}get retroarchCoreConfig(){const e={};return T(e,V().retroarchCoreConfig,this.nostalgistOptions.retroarchCoreConfig),e}get style(){const{element:e,style:t}=this.nostalgistOptions,a={backgroundColor:"black",imageRendering:"pixelated"};if(e)return T(a,t),a;const n={height:"100%",left:"0",position:"fixed",top:"0",width:"100%",zIndex:"1"};return T(n,a,t),n}loadPromises=[];nostalgistOptions;constructor(e){if(this.nostalgistOptions=e,this.emscriptenModule=e.emscriptenModule??{},this.respondToGlobalEvents=e.respondToGlobalEvents??!0,this.signal=e.signal,this.size=e.size??"auto",this.sramType=e.sramType??"srm",this.waitForInteraction=e.waitForInteraction,this.element=this.getElement(),typeof e.cache=="boolean")for(const t in this.cache)this.cache[t]=e.cache;else Object.assign(this.cache,e.cache)}static async create(e){const t=new P(e);return await t.load(),t}static resetCacheStore(){Object.assign(P.cacheStorage,ae())}async load(){this.loadFromCache(),await Promise.all(this.loadPromises),this.saveToCache()}loadFromCache(){const e=[],t={bios:this.updateBios,core:this.updateCore,rom:this.updateRom,shader:this.updateShader,sram:this.updateSRAM,state:this.updateState};for(const a in this.cache){const n=a;if(this.cache[n]){const i=P.cacheStorage[n],c=this.nostalgistOptions[n];if(re(c)){const l=i.get(c);if(l){this[n]=l;continue}}}const o=t[n].call(this);e.push(o)}this.loadPromises=e}saveToCache(){for(const e in this.cache){const t=e;if(this.cache[t]){const a=P.cacheStorage[t],n=this.nostalgistOptions[t],s=this[t];re(n)&&s&&a.set(n,s)}}}async updateSRAM(){this.nostalgistOptions.sram&&(this.sram=await _.create(this.nostalgistOptions.sram))}async updateState(){this.nostalgistOptions.state&&(this.state=await _.create(this.nostalgistOptions.state))}getElement(){if(typeof document!="object")throw new TypeError("document must be an object");let{element:e}=this.nostalgistOptions;if(typeof e=="string"&&e){const t=document.body.querySelector(e);if(!t)throw new Error(`can not find element "${e}"`);if(!(t instanceof HTMLCanvasElement))throw new TypeError(`element "${e}" is not a canvas element`);e=t}if(e||(e=document.createElement("canvas")),e instanceof HTMLCanvasElement)return e.id="canvas",e;throw new TypeError("invalid element")}async updateBios(){let{bios:e,resolveBios:t}=this.nostalgistOptions;if(!e||(e=await C(e),!e))return;const a=Array.isArray(e)?e:[e];this.bios=await Promise.all(a.map(n=>_.create(typeof n=="string"?{raw:n,signal:this.signal,urlResolver:()=>t(n,this.nostalgistOptions)}:{raw:n,signal:this.signal})))}async updateCore(){const{core:e,resolveCoreJs:t,resolveCoreWasm:a}=this.nostalgistOptions;if(typeof e=="object"&&"js"in e&&"name"in e&&"wasm"in e){const[i,c]=await Promise.all([_.create(e.js),_.create(e.wasm)]);this.core={js:i,name:e.name,wasm:c};return}const[n,s]=await Promise.all([t,a].map(i=>_.create({raw:e,signal:this.signal,urlResolver:()=>i(e,this.nostalgistOptions)}))),o=typeof e=="string"?e:n.name;this.core={js:n,name:o,wasm:s}}async updateRom(){let{resolveRom:e,rom:t}=this.nostalgistOptions;if(!t||(t=await C(t),!t))return;const a=Array.isArray(t)?t:[t];this.rom=await Promise.all(a.map(n=>_.create(typeof n=="string"?{raw:n,signal:this.signal,urlResolver:()=>e(n,this.nostalgistOptions)}:{raw:n,signal:this.signal})));for(const n of this.rom)n.name||=pe()}async updateShader(){let{resolveShader:e,shader:t}=this.nostalgistOptions;if(!t||(t=await C(t),!t))return;let a=await e(t,this.nostalgistOptions);if(!a||(a=await C(a),!a))return;const n=Array.isArray(a)?a:[a];this.shader=await Promise.all(n.map(s=>_.create({raw:s,signal:this.signal})))}}const st={2048:{savestate:!0,supportsNoGame:!0},"3dengine":{corename:"3DEngine"},"4do":{corename:"4DO",savestate:!0},81:{savestate:!0},a5200:{savestate:!0},advanced_tests:{corename:"Advanced Test",supportsNoGame:!0},ardens:{corename:"Ardens",savestate:!0},arduous:{corename:"Arduous"},atari800:{corename:"Atari800",savestate:!0},bk:{savestate:!0},blastem:{corename:"BlastEm",savestate:!0},bluemsx:{corename:"blueMSX",savestate:!0},bnes:{corename:"bnes/higan",savestate:!0},boom3:{},boom3_xp:{},bsnes:{savestate:!0},bsnes_cplusplus98:{cheats:!0,corename:"bsnes C++98 (v085)",savestate:!0},bsnes_hd_beta:{corename:"bsnes-hd beta",savestate:!0},bsnes_mercury_accuracy:{cheats:!0,corename:"bsnes-mercury Accuracy",savestate:!0},bsnes_mercury_balanced:{cheats:!0,corename:"bsnes-mercury Balanced",savestate:!0},bsnes_mercury_performance:{cheats:!0,corename:"bsnes-mercury Performance",savestate:!0},bsnes2014_accuracy:{cheats:!0,corename:"bsnes 2014 Accuracy",savestate:!0},bsnes2014_balanced:{cheats:!0,corename:"bsnes 2014 Balanced",savestate:!0},bsnes2014_performance:{cheats:!0,corename:"bsnes 2014 Performance",savestate:!0},cannonball:{corename:"Cannonball",supportsNoGame:!0},cap32:{corename:"Caprice32",savestate:!0,supportsNoGame:!0},cdi2015:{corename:"Philips CDi 2015"},chailove:{cheats:!0,corename:"ChaiLove",savestate:!0},chimerasnes:{cheats:!0,corename:"ChimeraSNES",savestate:!0},citra:{corename:"Citra",savestate:!0},citra_canary:{corename:"Citra Canary/Experimental"},citra2018:{corename:"Citra 2018"},craft:{corename:"Craft",supportsNoGame:!0},crocods:{corename:"CrocoDS",savestate:!0},cruzes:{corename:"Cruzes",supportsNoGame:!0},daphne:{corename:"Daphne"},desmume:{cheats:!0,corename:"DeSmuME",savestate:!0},desmume2015:{cheats:!0,corename:"DeSmuME 2015",savestate:!0},dinothawr:{corename:"Dinothawr",supportsNoGame:!0},directxbox:{corename:"DirectXBox"},dirksimple:{corename:"DirkSimple",savestate:!0},dolphin:{corename:"Dolphin",savestate:!0},dolphin_launcher:{corename:"Dolphin Launcher",supportsNoGame:!0},dosbox:{corename:"DOSBox",supportsNoGame:!0},dosbox_core:{corename:"DOSBox-core",supportsNoGame:!0},dosbox_pure:{cheats:!0,corename:"DOSBox-pure",savestate:!0,supportsNoGame:!0},dosbox_svn:{corename:"DOSBox-SVN",supportsNoGame:!0},dosbox_svn_ce:{corename:"DOSBox-SVN CE",supportsNoGame:!0},duckstation:{corename:"DuckStation",savestate:!0},easyrpg:{corename:"EasyRPG Player"},ecwolf:{corename:"ECWolf",savestate:!0},emuscv:{corename:"EmuSCV",supportsNoGame:!0},emux_chip8:{corename:"Emux CHIP-8"},emux_gb:{corename:"Emux GB"},emux_nes:{corename:"Emux NES"},emux_sms:{corename:"Emux SMS"},ep128emu_core:{cheats:!0,corename:"ep128emu-core",savestate:!0,supportsNoGame:!0},fake08:{corename:"FAKE-08",savestate:!0},fbalpha2012:{corename:"FB Alpha 2012",savestate:!0},fbalpha2012_cps1:{corename:"FB Alpha 2012 CPS-1",savestate:!0},fbalpha2012_cps2:{corename:"FB Alpha 2012 CPS-2",savestate:!0},fbalpha2012_cps3:{corename:"FB Alpha 2012 CPS-3",savestate:!0},fbalpha2012_neogeo:{corename:"FB Alpha 2012 Neo Geo",savestate:!0},fbneo:{cheats:!0,corename:"FinalBurn Neo",savestate:!0},fceumm:{cheats:!0,corename:"FCEUmm",savestate:!0},ffmpeg:{corename:"FFmpeg"},fixgb:{corename:"fixGB"},fixnes:{corename:"fixNES"},flycast:{corename:"Flycast",savestate:!0},flycast_gles2:{corename:"Flycast GLES2",savestate:!0},fmsx:{corename:"fMSX"},freechaf:{corename:"FreeChaF"},freeintv:{corename:"FreeIntv"},freej2me:{corename:"FreeJ2ME"},frodo:{corename:"Frodo"},fsuae:{corename:"FS-UAE"},fuse:{corename:"Fuse"},galaksija:{supportsNoGame:!0},gambatte:{corename:"Gambatte",savestate:!0},gearboy:{corename:"Gearboy"},gearcoleco:{corename:"Gearcoleco"},gearsystem:{corename:"Gearsystem"},genesis_plus_gx:{cheats:!0,corename:"Genesis Plus GX",savestate:!0},genesis_plus_gx_wide:{cheats:!0,corename:"Genesis Plus GX Wide",savestate:!0},gme:{corename:"Game Music Emu"},gong:{corename:"Gong",savestate:!0,supportsNoGame:!0},gpsp:{corename:"gpSP",savestate:!0},gw:{corename:"GW"},handy:{corename:"Handy",savestate:!0},hatari:{corename:"Hatari",savestate:!0},hbmame:{corename:"HBMAME (Git)"},higan_sfc:{corename:"nSide (Super Famicom Accuracy)",savestate:!0},higan_sfc_balanced:{corename:"nSide (Super Famicom Balanced)",savestate:!0},imageviewer:{corename:"Imageviewer"},ishiiruka:{corename:"Ishiiruka",savestate:!0},jaxe:{corename:"JAXE"},jumpnbump:{corename:"jumpnbump"},kronos:{cheats:!0,corename:"Kronos",savestate:!0},lowresnx:{corename:"lowresnx"},lutro:{corename:"Lutro"},mame:{corename:"MAME",savestate:!0},mame2000:{corename:"MAME 2000 (0.37b5)",savestate:!0},mame2003:{corename:"MAME 2003 (0.78)",savestate:!0},mame2003_midway:{corename:"MAME 2003 Midway (0.78)",savestate:!0},mame2003_plus:{corename:"MAME 2003-Plus",savestate:!0},mame2009:{corename:"MAME 2009 (0.135u4)"},mame2010:{corename:"MAME 2010 (0.139)"},mame2015:{corename:"MAME 2015 (0.160)"},mame2016:{corename:"MAME 2016 (0.174)"},mamearcade:{corename:"MAME (Git)"},mamemess:{corename:"MESS (Git)",savestate:!0},mednafen_gba:{corename:"Beetle GBA"},mednafen_lynx:{corename:"Beetle Lynx"},mednafen_ngp:{corename:"Beetle NeoPop",savestate:!0},mednafen_pce:{corename:"Beetle PCE",savestate:!0},mednafen_pce_fast:{corename:"Beetle PCE Fast",savestate:!0},mednafen_pcfx:{corename:"Beetle PC-FX"},mednafen_psx:{cheats:!0,corename:"Beetle PSX",savestate:!0},mednafen_psx_hw:{cheats:!0,corename:"Beetle PSX HW",savestate:!0},mednafen_saturn:{cheats:!0,corename:"Beetle Saturn",savestate:!0},mednafen_snes:{corename:"Beetle bsnes",savestate:!0},mednafen_supafaust:{cheats:!0,corename:"Beetle Supafaust",savestate:!0},mednafen_supergrafx:{cheats:!0,corename:"Beetle SuperGrafx",savestate:!0},mednafen_vb:{corename:"Beetle VB"},mednafen_wswan:{corename:"Beetle WonderSwan",savestate:!0},melonds:{corename:"melonDS"},mesen:{cheats:!0,corename:"Mesen",savestate:!0},"mesen-s":{corename:"Mesen-S"},mess2015:{corename:"MESS 2015 (0.160)"},meteor:{corename:"Meteor"},mgba:{cheats:!0,corename:"mGBA",savestate:!0},minivmac:{corename:"MinivmacII"},mojozork:{corename:"mojozork",savestate:!0},moonlight:{corename:"Moonlight",supportsNoGame:!0},mpv:{corename:"MPV"},mrboom:{corename:"Mr.Boom",savestate:!0,supportsNoGame:!0},mu:{corename:"Mu",supportsNoGame:!0},mupen64plus_next:{cheats:!0,corename:"Mupen64Plus-Next",savestate:!0},mupen64plus_next_develop:{cheats:!0,corename:"Mupen64Plus-Next",savestate:!0},mupen64plus_next_gles2:{cheats:!0,corename:"Mupen64Plus-Next",savestate:!0},mupen64plus_next_gles3:{cheats:!0,corename:"Mupen64Plus-Next",savestate:!0},nekop2:{corename:"Neko Project II",savestate:!0},neocd:{corename:"NeoCD"},nes:{savestate:!0},nestopia:{cheats:!0,corename:"Nestopia",savestate:!0},np2kai:{corename:"Neko Project II Kai",savestate:!0},numero:{corename:"Numero",savestate:!0,supportsNoGame:!0},nxengine:{corename:"NXEngine",supportsNoGame:!0},o2em:{corename:"O2EM",savestate:!0},oberon:{corename:"Oberon"},openlara:{corename:"OpenLara"},opentyrian:{corename:"OpenTyrian",supportsNoGame:!0},opera:{corename:"Opera",savestate:!0,supportsNoGame:!0},parallel_n64:{corename:"ParaLLEl N64",savestate:!0},parallel_n64_debug:{corename:"ParaLLEl (Debug)",savestate:!0},pascal_pong:{corename:"PascalPong",supportsNoGame:!0},pcem:{corename:"PCem",supportsNoGame:!0},pcsx_rearmed:{cheats:!0,corename:"PCSX-ReARMed",savestate:!0},pcsx_rearmed_interpreter:{cheats:!0,corename:"PCSX ReARMed [Interpreter]",savestate:!0},pcsx_rearmed_neon:{cheats:!0,corename:"PCSX ReARMed [NEON]",savestate:!0},pcsx1:{corename:"PCSX1"},pcsx2:{corename:"LRPS2",savestate:!0},picodrive:{cheats:!0,corename:"PicoDrive",savestate:!0},play:{corename:"Play!",savestate:!0},pocketcdg:{corename:"PocketCDG"},pokemini:{corename:"PokeMini",savestate:!0},potator:{corename:"Potator",savestate:!0},ppsspp:{corename:"PPSSPP",savestate:!0},prboom:{cheats:!0,corename:"PrBoom",savestate:!0},prosystem:{corename:"ProSystem",savestate:!0},puae:{cheats:!0,corename:"PUAE",savestate:!0,supportsNoGame:!0},puae2021:{cheats:!0,corename:"PUAE 2021",savestate:!0,supportsNoGame:!0},puzzlescript:{corename:"puzzlescript",savestate:!0},px68k:{corename:"PX68k",supportsNoGame:!0},quasi88:{cheats:!0,corename:"QUASI88",savestate:!0,supportsNoGame:!0},quicknes:{corename:"QuickNES",savestate:!0},race:{corename:"RACE",savestate:!0},redbook:{corename:"Redbook"},reminiscence:{corename:"REminiscence",savestate:!0},remotejoy:{corename:"RemoteJoy",supportsNoGame:!0},retro8:{corename:"Retro8"},retrodream:{corename:"RetroDream"},rustation:{corename:"Rustation"},same_cdi:{corename:"SAME CDi (Git)"},sameboy:{corename:"SameBoy"},sameduck:{corename:"SameDuck",savestate:!0},scummvm:{corename:"ScummVM",supportsNoGame:!0},simcp:{corename:"SimCoupe"},smsplus:{corename:"SMS Plus GX"},snes9x:{cheats:!0,corename:"Snes9x",savestate:!0},snes9x2002:{cheats:!0,corename:"Snes9x 2002",savestate:!0},snes9x2005:{cheats:!0,corename:"Snes9x 2005",savestate:!0},snes9x2005_plus:{cheats:!0,corename:"Snes9x 2005 Plus",savestate:!0},snes9x2010:{cheats:!0,corename:"Snes9x 2010",savestate:!0},squirreljme:{corename:"SquirrelJME",supportsNoGame:!0},stella:{corename:"Stella",savestate:!0},stella2014:{corename:"Stella 2014",savestate:!0},stonesoup:{corename:"Dungeon Crawl Stone Soup"},superbroswar:{corename:"superbroswar"},swanstation:{corename:"SwanStation",savestate:!0},tempgba:{corename:"TempGBA"},test:{corename:"Test",supportsNoGame:!0},test_netplay:{corename:"netplay-test",supportsNoGame:!0},testaudio_callback:{corename:"TestAudio Callback",supportsNoGame:!0},testaudio_no_callback:{corename:"TestAudio NoCallback",supportsNoGame:!0},testaudio_playback_wav:{corename:"TestAudio Playback Wav",supportsNoGame:!0},testgl:{corename:"TestGL",supportsNoGame:!0},testgl_compute_shaders:{corename:"TestGL ComputeShaders",supportsNoGame:!0},testgl_ff:{corename:"TestGL (FF)",supportsNoGame:!0},testinput_buttontest:{corename:"Button Test",supportsNoGame:!0},testretroluxury:{corename:"Test RetroLuxury",supportsNoGame:!0},testsw:{corename:"TestSW",supportsNoGame:!0},testsw_vram:{corename:"TestSW VRAM",supportsNoGame:!0},testvulkan:{corename:"TestVulkan",supportsNoGame:!0},testvulkan_async_compute:{corename:"TestVulkan AsyncCompute",supportsNoGame:!0},tgbdual:{corename:"TGB Dual",savestate:!0},theodore:{corename:"theodore",savestate:!0,supportsNoGame:!0},thepowdertoy:{corename:"ThePowderToy",savestate:!0,supportsNoGame:!0},tic80:{cheats:!0,corename:"TIC-80",savestate:!0},tyrquake:{cheats:!0,corename:"TyrQuake"},uae4arm:{corename:"UAE4ARM",savestate:!0},ume2015:{corename:"UME 2015 (0.160)"},uw8:{corename:"MicroW8",savestate:!0},uzem:{savestate:!0},vaporspec:{corename:"VaporSpec",savestate:!0},vba_next:{corename:"VBA Next",savestate:!0},vbam:{cheats:!0,corename:"VBA-M",savestate:!0},vecx:{savestate:!0},vemulator:{corename:"VeMUlator"},vice_x128:{cheats:!0,corename:"VICE x128",savestate:!0,supportsNoGame:!0},vice_x64:{cheats:!0,corename:"VICE x64",savestate:!0,supportsNoGame:!0},vice_x64dtv:{cheats:!0,corename:"VICE x64dtv",savestate:!0,supportsNoGame:!0},vice_x64sc:{cheats:!0,corename:"VICE x64sc",savestate:!0,supportsNoGame:!0},vice_xcbm2:{cheats:!0,corename:"VICE xcbm2",savestate:!0,supportsNoGame:!0},vice_xcbm5x0:{cheats:!0,corename:"VICE xcbm5x0",savestate:!0,supportsNoGame:!0},vice_xpet:{cheats:!0,corename:"VICE xpet",savestate:!0,supportsNoGame:!0},vice_xplus4:{cheats:!0,corename:"VICE xplus4",savestate:!0,supportsNoGame:!0},vice_xscpu64:{cheats:!0,corename:"VICE xscpu64",savestate:!0,supportsNoGame:!0},vice_xvic:{cheats:!0,corename:"VICE xvic",savestate:!0,supportsNoGame:!0},vircon32:{corename:"Vircon32",supportsNoGame:!0},virtualjaguar:{corename:"Virtual Jaguar"},virtualxt:{},vitaquake2:{corename:"vitaQuake 2"},"vitaquake2-rogue":{corename:"vitaQuake 2 [Rogue]"},"vitaquake2-xatrix":{corename:"vitaQuake 2 [Xatrix]"},"vitaquake2-zaero":{corename:"vitaQuake 2 [Zaero]"},vitaquake3:{corename:"vitaQuake 3"},vitavoyager:{corename:"vitaVoyager"},wasm4:{corename:"WASM-4",savestate:!0},x1:{},x64sdl:{corename:"VICE SDL"},xrick:{corename:"XRick",supportsNoGame:!0},yabasanshiro:{cheats:!0,corename:"YabaSanshiro",savestate:!0},yabause:{cheats:!0,corename:"Yabause",savestate:!0}},rt={add:"NumpadAdd",alt:"AltLeft",backquote:"Backquote",backslash:"",backspace:"Backspace",capslock:"CapsLock",comma:"Comma",ctrl:"ControlLeft",del:"Delete",divide:"NumpadDivide",down:"ArrowDown",end:"End",enter:"Enter",equals:"Equal",escape:"Escape",home:"Home",insert:"Insert",kp_enter:"NumpadEnter",kp_equals:"NumpadEquals",kp_minus:"NumpadSubtract",kp_period:"NumpadDecimal",kp_plus:"NumpadAdd",left:"ArrowLeft",leftbracket:"BracketLeft",minus:"Minus",multiply:"NumpadMultiply",numlock:"NumLock",pagedown:"PageDown",pageup:"PageUp",pause:"Pause",period:"Period",print_screen:"PrintScreen",quote:"Quote",ralt:"AltRight",rctrl:"ControlRight",right:"ArrowRight",rightbracket:"BracketRight",rshift:"ShiftRight",scroll_lock:"ScrollLock",semicolon:"Semicolon",shift:"ShiftLeft",slash:"Slash",space:"Space",subtract:"NumpadSubtract",tab:"Tab",tilde:"",up:"ArrowUp"};function at(r){let e;const t=new Promise(n=>{e=n});return{noExitRuntime:!1,noInitialRun:!0,locateFile(n){return n},async monitorRunDependencies(n){return n===0&&e(),await t},print(...n){console.info(...n)},printErr(...n){console.error(...n)},quit(n,s){n&&console.info(n,s)},...r}}const{ini:nt,path:x}=N,k="/home/web_user/retroarch/userdata",be="/home/web_user/retroarch/bundle",ne=x.join(k,"content"),oe=x.join(k,"system"),ie=x.join(k,"config"),ot=x.join(k,"screenshots"),z=x.join(be,"shaders","shaders_glsl"),it=x.join(z,"shaders"),ct=x.join(k,"retroarch.cfg"),ut=x.join(k,"retroarch-core-options.cfg");class v{static bundleDirectory=be;static configDirectory=ie;static configPath=ct;static contentDirectory=ne;static coreConfigPath=ut;static screenshotsDirectory=ot;static shaderDirectory=z;static systemDirectory=oe;static userdataDirectory=k;emscriptenModule;signal;get FS(){return this.emscriptenModule.FS}constructor({emscriptenModule:e,signal:t}){this.emscriptenModule=e,this.signal=t}static async create(...e){const t=new v(...e);return await t.prepare(),t}mkdirTree(e){const{FS:t}=this;t.mkdirTree(e)}readdir(e){const{FS:t}=this;return t.readdir(e)}readFile(e,t="utf8"){const{FS:a}=this;return a.readFile(e,{encoding:t})}stat(e){const{FS:t}=this;try{return t.stat(e)}catch{return null}}unlink(e){const{FS:t}=this;try{t.unlink(e)}catch{}}async waitForFile(e){let a=-1,n=!1,s=0;for(;s<=120&&!n;){const o=Math.min(50*2**s,500);await U(o),F(this.signal);const i=this.stat(e);if(i){const c=i.size;a>0&&c===a&&(n=!0),a=c}s+=1}if(!n)throw new Error("fs timeout");return this.readFile(e,"binary").buffer}async writeFile(e,t){const{FS:a}=this,n=x.dirname(e),s=x.basename(e),i=await(await _.create(t)).getUint8Array();a.createDataFile("/",s,i,!0,!1);const c="binary",l=this.readFile(s,c);this.mkdirTree(n),a.writeFile(e,l,{encoding:c}),this.unlink(s)}async writeIni(e,t){if(!t)return;const a={};for(const s in t)a[s]=`__${t[s]}__`;const n=nt.stringify(a,{platform:"linux",whitespace:!0}).replaceAll("__",'"');await this.writeFile(e,n)}async prepare(){const e=[ie,ne,z,it,oe];for(const n of e)this.mkdirTree(n);const t=100;let a=0;for(;!this.emscriptenModule.asm&&a<t;)await U(10),F(this.signal),a+=5}}const{ini:lt,path:E}=N,mt=[globalThis.HTMLAnchorElement,globalThis.HTMLButtonElement,globalThis.HTMLDetailsElement,globalThis.HTMLInputElement,globalThis.HTMLSelectElement,globalThis.HTMLTextAreaElement].filter(Boolean);function ht(r){return r&&mt.some(e=>r instanceof e)}class ft{canvasInitialSize={height:0,width:0};emscripten;eventListeners={beforeLaunch:[],onLaunch:[]};fileSystem;gameStatus="initial";globalDOMEventListeners=new Map;messageQueue=[];options;get coreFullName(){const{core:e}=this.options,t=st[e.name].corename||e.name;if(!t)throw new Error(`invalid core name: ${e.name}`);return t}get fs(){if(!this.fileSystem)throw new Error("fileSystem is not ready");return this.fileSystem}get romBaseName(){const{rom:[{baseName:e}]}=this.options;return e}get sramFileDirectory(){return E.join(v.userdataDirectory,"saves",this.coreFullName)}get sramFilePath(){return E.join(this.sramFileDirectory,`${this.romBaseName}.${this.sramFileType}`)}get sramFileType(){return this.options.sramType}get stateFileDirectory(){return E.join(v.userdataDirectory,"states",this.coreFullName)}get stateFilePath(){return E.join(this.stateFileDirectory,`${this.romBaseName}.state`)}get stateThumbnailFilePath(){return`${this.stateFilePath}.png`}constructor(e){this.options=e}callCommand(e){const{Module:t}=this.getEmscripten();t[e]?.()}exit(e=0){const{exit:t,JSEvents:a}=this.getEmscripten();try{t(e)}catch{}a.removeAllEventListeners(),this.removeGlobalDOMEventListeners(),he(),this.gameStatus="terminated"}getEmscripten(){if(!this.emscripten)throw new Error("emulator is not ready");return this.emscripten}getOptions(){return this.options}getStatus(){return this.gameStatus}async launch(){const{element:e,respondToGlobalEvents:t,signal:a,style:n,waitForInteraction:s}=this.options;$e(e,n);const o=e.style.removeProperty.bind(e.style);if(e.style.removeProperty=i=>i!=="width"&&i!=="height"?o(i):e.style[i],e.isConnected||(document.body.append(e),a?.addEventListener("abort",()=>{e?.remove()})),this.canvasInitialSize=this.getElementSize(),t===!1){(!e.tabIndex||e.tabIndex===-1)&&(e.tabIndex=0);const{activeElement:i}=document;e.focus(),a?.addEventListener("abort",()=>{i instanceof HTMLElement&&i.focus()})}await this.runEventListeners("beforeLaunch"),s?s({done:async()=>{this.runMain(),await this.runEventListeners("onLaunch")}}):(this.runMain(),await this.runEventListeners("onLaunch"))}async loadState(e){this.clearStateFile(),await this.fs.writeFile(this.stateFilePath,e),await this.fs.waitForFile(this.stateFilePath),this.sendCommand("LOAD_STATE")}on(e,t){return this.eventListeners[e].push(t),this}pause(){this.gameStatus==="running"&&this.sendCommand("PAUSE_TOGGLE"),this.gameStatus="paused"}async press(e,t=1,a=100){const n=this.getKeyboardCode(e,t);n&&await this.keyboardPress(n,a)}pressDown(e,t=1){const a=this.getKeyboardCode(e,t);a&&this.keyboardDown(a)}pressUp(e,t=1){const a=this.getKeyboardCode(e,t);a&&this.keyboardUp(a)}resize({height:e,width:t}){const{Module:a}=this.getEmscripten();typeof t=="number"&&typeof e=="number"&&a.setCanvasSize(t,e)}restart(){this.sendCommand("RESET"),this.resume()}resume(){this.gameStatus==="paused"&&this.sendCommand("PAUSE_TOGGLE"),this.gameStatus="running"}async saveSRAM(){this.fs.unlink(this.sramFilePath),this.callCommand("_cmd_savefiles");const e=await this.fs.waitForFile(this.sramFilePath);return new Blob([e],{type:"application/octet-stream"})}async saveState(){this.clearStateFile(),this.sendCommand("SAVE_STATE");const e=this.options.retroarchConfig.savestate_thumbnail_enable;let t,a;e?[t,a]=await Promise.all([this.fs.waitForFile(this.stateFilePath),this.fs.waitForFile(this.stateThumbnailFilePath)]):t=await this.fs.waitForFile(this.stateFilePath),this.clearStateFile();const n=new Blob([t],{type:"application/octet-stream"}),s=a?new Blob([a],{type:"image/png"}):void 0;return{state:n,thumbnail:s}}async screenshot(){this.sendCommand("SCREENSHOT");const e=this.guessScreenshotFileName(),t=E.join(v.screenshotsDirectory,e),a=await this.fs.waitForFile(t);return this.fs.unlink(t),new Blob([a],{type:"image/png"})}sendCommand(e){const t={LOAD_STATE:"_cmd_load_state",PAUSE_TOGGLE:"_cmd_toggle_pause",RESET:"_cmd_reset",SAVE_STATE:"_cmd_save_state",SCREENSHOT:"_cmd_take_screenshot"},{Module:a}=this.getEmscripten();if(t[e]&&t[e]in a)this.callCommand(t[e]);else if("EmscriptenSendCommand"in a)a.EmscriptenSendCommand(e);else{const n=De.encode(`${e}
`);this.messageQueue.push([n,0])}}async setup(){await this.setupEmscripten(),await this.setupFileSystem()}clearStateFile(){try{this.fs.unlink(this.stateFilePath),this.fs.unlink(this.stateThumbnailFilePath)}catch{}}fireKeyboardEvent(e,t){const{JSEvents:a}=this.getEmscripten();for(const{eventListenerFunc:n,eventTypeString:s}of a.eventHandlers)if(s===e)try{n({code:t,target:this.options.element})}catch{}}getCurrentRetroarchConfig(){const e=this.fs.readFile(v.configPath);return lt.parse(e)}getElementSize(){const{element:e,size:t}=this.options;return!t||t==="auto"?{height:e.offsetHeight,width:e.offsetWidth}:t}getKeyboardCode(e,t=1){const a=this.getCurrentRetroarchConfig(),n=`input_player${t}_${e}`,s=a[n];if(!s||s==="nul")return;const{length:o}=s;return o===1?`Key${s.toUpperCase()}`:s[0]==="f"&&(o===2||o===3)?s.toUpperCase():o===4&&s.startsWith("num")?`Numpad${s.at(-1)}`:o===7&&s.startsWith("keypad")?`Digit${s.at(-1)}`:rt[s]||""}guessScreenshotFileName(){const e=new Date,t=e.getFullYear()%1e3,a=B(e.getMonth()+1),n=B(e.getDate()),s=B(e.getHours()),o=B(e.getMinutes()),i=B(e.getSeconds()),c=`${t}${a}${n}-${s}${o}${i}`;return`${this.romBaseName}-${c}.png`}keyboardDown(e){this.fireKeyboardEvent("keydown",e)}async keyboardPress(e,t=100){this.keyboardDown(e),await U(t),this.keyboardUp(e)}keyboardUp(e){this.fireKeyboardEvent("keyup",e)}postRun(){this.resize(this.canvasInitialSize);for(const e of navigator.getGamepads?.()??[])e&&globalThis.dispatchEvent(new GamepadEvent("gamepadconnected",{gamepad:e}));this.updateKeyboardEventHandlers()}recordGlobalDOMEventListeners(){for(const e of[globalThis,document])e.addEventListener=(...t)=>{const[a,n]=t,s=this.globalDOMEventListeners.get(e)||{};return s[a]=n,this.globalDOMEventListeners.set(e,s),EventTarget.prototype.addEventListener.apply(e,t)}}removeGlobalDOMEventListeners(){for(const[e,t]of this.globalDOMEventListeners)for(const a in t){const n=t[a];e.removeEventListener(a,n)}}async runEventListeners(e){const{[e]:t}=this.eventListeners;for(const a of t)await a()}runMain(){F(this.options.signal);const{Module:e}=this.getEmscripten(),{arguments:t=[]}=e,{rom:a,signal:n}=this.options;if(!e.arguments&&a.length>0){const[{name:s}]=a;t.push(E.join(v.contentDirectory,s))}t.push("-c",v.configPath),Be(),this.recordGlobalDOMEventListeners(),e.callMain(t);for(const[s]of this.globalDOMEventListeners)delete s.addEventListener;n?.addEventListener("abort",()=>{this.exit()}),this.gameStatus="running",this.postRun()}async setupEmscripten(){const{core:e,element:t,emscriptenModule:a}=this.options,{wasm:n}=e,s={canvas:t,preRun:[],wasmBinary:await n.getArrayBuffer(),...a},o=at(s);o.preRun?.push(()=>o.FS.init(()=>this.stdin()));const{getEmscripten:i}=await ze(e);F(this.options.signal);const c=await i({Module:o});F(this.options.signal);const l=c.Module??c;this.emscripten={...c,Module:l},await l.monitorRunDependencies(),F(this.options.signal)}async setupFileSystem(){const{Module:e}=this.getEmscripten(),{bios:t,rom:a,signal:n,sram:s,state:o}=this.options;for(const{name:l}of t)if(!l)throw new Error("file name is required for bios");const i=await v.create({emscriptenModule:e,signal:n});this.fileSystem=i,o&&this.fs.mkdirTree(this.stateFileDirectory),s&&this.fs.mkdirTree(this.sramFileDirectory);const c=[...a.map(l=>this.fs.writeFile(E.join(v.contentDirectory,l.name),l)),...t.map(l=>this.fs.writeFile(E.join(v.systemDirectory,l.name),l))];o&&c.push(this.fs.writeFile(`${this.stateFilePath}.auto`,o)),s&&c.push(this.fs.writeFile(this.sramFilePath,s)),await Promise.all(c),F(n),await this.setupRaConfigFiles(),F(this.options.signal)}async setupRaConfigFiles(){await this.fs.writeIni(v.configPath,this.options.retroarchConfig),await this.fs.writeIni(v.coreConfigPath,this.options.retroarchCoreConfig),await this.setupRaShaderFiles()}async setupRaShaderFiles(){const{shader:e}=this.options;if(e.length===0)return;const t=e.filter(n=>n.name.endsWith(".glslp"));if(t.length===0)return;for(const{name:n}of e)if(!n)throw new Error("file name is required for shader");const a=t.map(n=>`#reference "${E.join(v.shaderDirectory,n.name)}"`).join(`
`);await this.fs.writeFile(E.join(v.configDirectory,"global.glslp"),a),await Promise.all(e.map(async n=>{const s=n.extension===".glslp"?v.shaderDirectory:E.join(v.shaderDirectory,"shaders");await this.fs.writeFile(E.join(s,n.name),n)}))}stdin(){const{messageQueue:e}=this;for(;e.length>0;){const t=e[0][0],a=e[0][1];if(a>=t.length)e.shift();else return e[0][1]=a+1,t[a]}return null}updateKeyboardEventHandlers(){const{JSEvents:e}=this.getEmscripten(),{element:t,respondToGlobalEvents:a}=this.options;a||(t.getAttribute("tabindex")||(t.tabIndex=-1),t.focus(),t.addEventListener("click",()=>{t.focus()}));const n=new Set(["keydown","keypress","keyup"]),s=e.eventHandlers.filter(({eventTypeString:o,target:i})=>n.has(o)&&(i===document||i===t));for(const o of s){const{eventTypeString:i,handlerFunc:c,target:l}=o;e.registerOrRemoveHandler({eventTypeString:i,target:l}),e.registerOrRemoveHandler({...o,handlerFunc:(...u)=>{const[m]=u,h=m?.target;(a?!ht(h):h===t)&&c(...u)},target:a?document:t})}}}class S{static Nostalgist=S;static vendors=N;emulator;emulatorOptions;options;constructor(e){const t={};T(t,V(),e),this.options=t}static clearCache(){P.resetCacheStore()}static configure(e){Ye(e)}static async gb(e){return await S.launchSystem("gb",e)}static async gba(e){return await S.launchSystem("gba",e)}static async gbc(e){return await S.launchSystem("gbc",e)}static async launch(e){const t=new S(e);return await t.load(),t}static async megadrive(e){return await S.launchSystem("megadrive",e)}static async nes(e){return await S.launchSystem("nes",e)}static async prepare(e){const t=new S({...e,runEmulatorManually:!0});return await t.load(),t}static resetToDefault(){et()}static async snes(e){return await S.launchSystem("snes",e)}static async launchSystem(e,t){const a=await C(t),n=ge(a)?{rom:a}:a;return await S.launch({...n,core:ve[e]})}exit({removeCanvas:e=!0}={}){this.getEmulator().exit(),e&&this.getCanvas().remove()}getCanvas(){return this.getEmulatorOptions().element}getEmscripten(){return this.getEmulator().getEmscripten()}getEmscriptenAL(){return this.getEmulator().getEmscripten().AL}getEmscriptenFS(){return this.getEmulator().getEmscripten().Module.FS}getEmscriptenModule(){return this.getEmulator().getEmscripten().Module}getEmulator(){const{emulator:e}=this;if(!e)throw new Error("emulator is not ready");return e}getEmulatorOptions(){if(!this.emulatorOptions)throw new Error("emulator options are not ready");return this.emulatorOptions}getOptions(){return this.options}getStatus(){return this.getEmulator().getStatus()}async launchEmulator(){return await this.start()}async loadState(e){const t=await _.create(e);await this.getEmulator().loadState(t)}pause(){this.getEmulator().pause()}async press(e){const t=this.getEmulator();await(typeof e=="string"?t.press(e):t.press(e.button,e.player,e.time))}pressDown(e){const t=this.getEmulator();return typeof e=="string"?t.pressDown(e):t.pressDown(e.button,e.player)}pressUp(e){const t=this.getEmulator();return typeof e=="string"?t.pressUp(e):t.pressUp(e.button,e.player)}resize(e){return this.getEmulator().resize(e)}restart(){this.getEmulator().restart()}resume(){this.getEmulator().resume()}async saveSRAM(){return await this.getEmulator().saveSRAM()}async saveState(){return await this.getEmulator().saveState()}async screenshot(){return await this.getEmulator().screenshot()}sendCommand(e){return this.getEmulator().sendCommand(e)}async start(){return await this.getEmulator().launch()}async load(){this.emulatorOptions=await P.create(this.options),F(this.options.signal),!this.options.setupEmulatorManually&&(await this.setupEmulator(),!this.options.runEmulatorManually&&await this.start())}async setupEmulator(){const e=this.getEmulatorOptions();this.emulator=new ft(e),this.emulator.on("onLaunch",()=>this.options.onLaunch?.(this)).on("beforeLaunch",()=>this.options.beforeLaunch?.(this)),await this.emulator.setup()}}await S.launch({core:"gam4980",rom:"v2.0().gam",resolveCoreJs(r){return`/cores/${r}_libretro.js`},resolveCoreWasm(r){return`/cores/${r}_libretro.wasm`},resolveRom(r){return`/roms/${r}`},retroarchCoreConfig:{gam4980_cpu_rate:"2.00",gam4980_timer_rate:"2.00",gam4980_lcd_color:"blue"},async beforeLaunch(r){const e=r.getEmscriptenFS(),t=await fetch("/system/gam4980/8.BIN"),a=await fetch("/system/gam4980/E.BIN"),n="/home/web_user/retroarch/userdata/system/gam4980";e.mkdir(n),e.writeFile(`${n}/8.BIN`,await t.bytes()),e.writeFile(`${n}/E.BIN`,await a.bytes())}});
